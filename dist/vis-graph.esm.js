class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.nodes=[],this.links=[],this.width=800,this.height=600,this.selectedNode=null,this.tooltipTimeout=null,this.currentEndpoint=null}static get observedAttributes(){return["width","height"]}attributeChangedCallback(e,t,n){t!==n&&("width"===e?(this.width=parseInt(n)||800,this.render()):"height"===e&&(this.height=parseInt(n)||600,this.render()))}connectedCallback(){this.render()}setData(e,t){this.nodes=e,this.links=t,this.render()}async loadFromSparqlEndpoint(e,t){try{this.currentEndpoint=e;const n=new URLSearchParams;n.append("query",t.trim()),n.append("format","json");const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/sparql-results+json"},body:n});if(!o.ok)throw new Error(`Erreur HTTP: ${o.status}`);const r=await o.json();this.lastSparqlData=r;const s=this.transformSparqlResults(r);return this.nodes=s.nodes,this.links=s.links,this.render(),{status:"success",message:`Données chargées: ${this.nodes.length} nœuds, ${this.links.length} liens`,data:s,rawData:r}}catch(e){return console.error("Erreur lors du chargement des données:",e),{status:"error",message:`Erreur: ${e.message}`,data:null,rawData:null}}}_determineNodeLabelFromBinding(e,t,n,o){const r=this.extractIdFromBinding(e);if(!e)return r;if("literal"===e.type)return e.value;if("uri"===e.type){const e=["Label","Name","Title","Term","Identifier","Id","Description"];for(const o of e){const e=t+o;if(n[e]&&"literal"===n[e].type)return n[e].value;const r=t+o.charAt(0).toLowerCase()+o.slice(1);if(n[r]&&"literal"===n[r].type)return n[r].value}let r=null,s=-1;const a={label:5,name:5,title:5,term:4,description:3,summary:3,comment:3,text:2,taxon:2,species:2,organism:2,disease:2,condition:2,syndrome:2,gene:1,protein:1,ensembl:1,uniprot:1,annotation:1};for(const e of o){if(e===t)continue;const o=n[e];if(o&&"literal"===o.type&&o.value){const t=e.toLowerCase();let n=0;for(const e in a)t.includes(e)&&(n=Math.max(n,a[e]));["label","name","title"].includes(t)&&(n+=2),n>s?(s=n,r=o.value):n===s&&r&&o.value.length<r.length&&(r=o.value)}}if(r)return r}return r}transformSparqlResults(e){if(!e.results||!e.results.bindings||0===e.results.bindings.length)return console.warn("Résultats SPARQL vides ou invalides"),{nodes:[],links:[]};const t=new Map,n=new Map,o=e.head.vars;console.log("Variables SPARQL disponibles:",o);const r=o[0],s=o.length>1?o[1]:null;return e.results.bindings.forEach((e=>{if(e[r]){const a=this.extractIdFromBinding(e[r]),i=this._determineNodeLabelFromBinding(e[r],r,e,o),l="uri"===e[r].type?e[r].value:null;if(t.has(a)||t.set(a,{id:a,label:i,uri:l,originalData:{...e}}),s&&e[s]){const r=this.extractIdFromBinding(e[s]),i=this._determineNodeLabelFromBinding(e[s],s,e,o),l="uri"===e[s].type?e[s].value:null;t.has(r)||t.set(r,{id:r,label:i,uri:l,originalData:{...e}});const d=`${a}-${r}`;n.has(d)||n.set(d,{source:a,target:r})}}})),{nodes:Array.from(t.values()),links:Array.from(n.values())}}extractIdFromBinding(e){if(!e)return"unknown";if("literal"===e.type)return e.value;const t=e.value;if(!t)return"unknown";if(t.includes("gateway.pl")&&t.includes("p1="))try{const e=new URL(t),n=new URLSearchParams(e.search);if(n.has("p1"))return n.get("p1")}catch(e){const n=t.match(/p1=([^&]+)/);if(n&&n[1])return n[1]}const n=t.split(/[/#]/);let o=n.pop();return o&&o.includes("?")&&(o=o.split("?")[0]),!o&&n.length>0&&(o=n.pop()),o||t}async executeNodeQuery(e){if(!e||!e.uri)return console.error("Aucun URI disponible pour ce nœud"),void this.showNotification("Ce nœud n'a pas d'URI associé","error");try{this.showNotification(`Récupération des détails pour ${e.label}...`);const t=this.currentEndpoint||this.getAttribute("endpoint")||"https://dbpedia.org/sparql",n=this.buildInformativeQueries(e.uri);let o={descriptive:null,technical:null,relationships:null};console.log(`[VisGraph] Requêtes pour les détails du nœud ${e.label} (URI: ${e.uri}) sur l'endpoint: ${t}`);for(const[e,r]of Object.entries(n)){console.log(`[VisGraph] Exécution de la requête de type "${e}":\n${r}`);try{const n=await this.executeSparqlQuery(t,r);o[e]=n}catch(t){console.warn(`[VisGraph] Erreur pour la requête ${e}:`,t),this.showNotification(`Erreur lors de la récupération des données de type ${e}.`,"error")}}return this.displayRichNodeDetails(e,o),{status:"success",data:o}}catch(t){return console.error("[VisGraph] Erreur majeure lors de la récupération des détails du nœud:",t),this.showNotification(`Erreur: ${t.message}`,"error"),this.displayBasicNodeDetails(e),{status:"error",message:t.message}}}buildInformativeQueries(e){const t={};return t.descriptive=`\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      PREFIX dc: <http://purl.org/dc/elements/1.1/>\n      PREFIX dcterms: <http://purl.org/dc/terms/>\n      PREFIX foaf: <http://xmlns.com/foaf/0.1/>\n      \n      SELECT DISTINCT ?property ?value ?lang\n      WHERE {\n        <${e}> ?property ?value .\n        \n        FILTER (\n          ?property = rdfs:label ||\n          ?property = rdfs:comment ||\n          ?property = skos:prefLabel ||\n          ?property = skos:altLabel ||\n          ?property = skos:definition ||\n          ?property = skos:note ||\n          ?property = dc:title ||\n          ?property = dcterms:title ||\n          ?property = dc:description ||\n          ?property = dcterms:description ||\n          ?property = foaf:name\n        )\n        \n        BIND(LANG(?value) as ?lang)\n      }\n      ORDER BY ?property\n      LIMIT 100\n    `,t.relationships=`\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n      PREFIX owl: <http://www.w3.org/2002/07/owl#>\n      PREFIX skos: <http://www.w3.org/2004/02/skos/core#>\n      \n      SELECT DISTINCT ?property ?value ?valueLabel\n      WHERE {\n        <${e}> ?property ?value .\n        \n        FILTER (\n          ?property = rdfs:subClassOf ||\n          ?property = rdf:type ||\n          ?property = skos:broader ||\n          ?property = skos:narrower ||\n          ?property = skos:related ||\n          ?property = owl:sameAs ||\n          ?property = owl:equivalentClass ||\n          ?property = rdfs:seeAlso ||\n          ?property = dcterms:isPartOf ||\n          ?property = dcterms:hasPart\n        )\n        \n        OPTIONAL {\n          ?value rdfs:label ?valueLabel .\n          FILTER(LANG(?valueLabel) = "" || LANGMATCHES(LANG(?valueLabel), "en") || LANGMATCHES(LANG(?valueLabel), "fr"))\n        }\n        OPTIONAL {\n            ?value skos:prefLabel ?prefLabel .\n            FILTER(LANG(?prefLabel) = "" || LANGMATCHES(LANG(?prefLabel), "en") || LANGMATCHES(LANG(?prefLabel), "fr"))\n        }\n        BIND(COALESCE(?valueLabel, ?prefLabel, "") AS ?valueLabel)\n\n      }\n      ORDER BY ?property\n      LIMIT 50\n    `,t.technical=`\n      PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n      PREFIX owl: <http://www.w3.org/2002/07/owl#>\n      PREFIX dc: <http://purl.org/dc/elements/1.1/>\n      PREFIX dcterms: <http://purl.org/dc/terms/>\n      PREFIX foaf: <http://xmlns.com/foaf/0.1/>\n      \n      SELECT DISTINCT ?property ?value ?valueType\n      WHERE {\n        <${e}> ?property ?value .\n        \n        FILTER (\n          ?property != rdfs:label &&\n          ?property != rdfs:comment &&\n          ?property != skos:prefLabel &&\n          ?property != skos:altLabel &&\n          ?property != skos:definition &&\n          ?property != skos:note &&\n          ?property != dc:title &&\n          ?property != dcterms:title &&\n          ?property != dc:description &&\n          ?property != dcterms:description &&\n          ?property != foaf:name &&\n          ?property != rdfs:subClassOf &&\n          ?property != rdf:type &&\n          ?property != skos:broader &&\n          ?property != skos:narrower &&\n          ?property != skos:related &&\n          ?property != owl:sameAs &&\n          ?property != owl:equivalentClass &&\n          ?property != rdfs:seeAlso &&\n          ?property != dcterms:isPartOf &&\n          ?property != dcterms:hasPart\n        )\n        \n        BIND(\n          IF(isLiteral(?value), "literal",\n            IF(isURI(?value), "uri", "unknown")\n          ) AS ?valueType\n        )\n      }\n      ORDER BY ?property\n      LIMIT 150\n    `,t}async executeSparqlQuery(e,t){const n=new URLSearchParams;n.append("query",t.trim()),n.append("format","json");const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/sparql-results+json"},body:n});if(!o.ok)throw new Error(`Erreur HTTP: ${o.status}`);return await o.json()}displayRichNodeDetails(e,t){const n=this.shadowRoot.querySelector(".node-details-panel");n&&n.remove();const o=document.createElement("div");o.className="node-details-panel";const r=document.createElement("div");r.className="panel-header";const s=document.createElement("h2");s.textContent=e.label,s.style.margin="0",s.style.fontSize="18px",s.style.fontWeight="bold";const a=document.createElement("button");a.textContent="×",a.className="close-btn",a.addEventListener("click",(()=>o.remove())),r.appendChild(s),r.appendChild(a),o.appendChild(r);const i=document.createElement("div");i.className="panel-content",this.addBasicInfoSection(i,e),this.addGraphContextSection(i,e),t.descriptive&&t.descriptive.results&&t.descriptive.results.bindings.length>0&&this.addCompleteDescriptiveSection(i,t.descriptive.results.bindings),t.relationships&&t.relationships.results&&t.relationships.results.bindings.length>0&&this.addCompleteRelationshipsSection(i,t.relationships.results.bindings),t.technical&&t.technical.results&&t.technical.results.bindings.length>0&&this.addCompleteTechnicalSection(i,t.technical.results.bindings),this.addDataSummary(i,t),o.appendChild(i),this.shadowRoot.querySelector(".graph-container").appendChild(o)}addBasicInfoSection(e,t){const n=document.createElement("div");n.className="info-section",n.style.marginBottom="20px";const o=document.createElement("h3");o.textContent="Basic Information",o.style.borderBottom="2px solid #007cba",o.style.paddingBottom="5px",o.style.marginBottom="15px",n.appendChild(o),this.addDetailedInfoRow(n,"Label",t.label),this.addDetailedInfoRow(n,"URI",t.uri,!0),this.addDetailedInfoRow(n,"Accession",this.extractAccessionFromURI(t.uri));const r=this.links.filter((e=>e.source.id===t.id||e.target.id===t.id)).length;this.addDetailedInfoRow(n,"Connections in Graph",r.toString()),e.appendChild(n)}addGraphContextSection(e,t){if(!t.originalData)return;const n=this.extractGraphContext(t);if(0===n.length)return;const o=document.createElement("div");o.className="info-section",o.style.marginBottom="20px";const r=document.createElement("h3");r.textContent="Graph Context (from original data)",r.style.borderBottom="2px solid #17a2b8",r.style.paddingBottom="5px",r.style.marginBottom="15px",o.appendChild(r),n.forEach((e=>{this.addDetailedInfoRow(o,e.type,e.value,e.isUri)})),e.appendChild(o)}extractGraphContext(e){const t=[];if(!(e.originalData&&this.lastSparqlData&&this.lastSparqlData.head&&this.lastSparqlData.head.vars))return t;const n=this.lastSparqlData.head.vars,o=n[0],r=n.length>1?n[1]:null,s=n.filter((e=>e.toLowerCase().includes("label")||e.toLowerCase().includes("name")||e.toLowerCase().includes("title")));for(const[n,a]of Object.entries(e.originalData))n!==o&&n!==r&&!s.includes(n)&&"type"!==n&&"lang"!==n&&a&&void 0!==a.value&&t.push({type:this.getReadablePropertyName(n),value:a.value,isUri:"uri"===a.type});return t}addCompleteDescriptiveSection(e,t){const n=document.createElement("div");n.className="info-section",n.style.marginBottom="20px";const o=document.createElement("h3");o.textContent=`Descriptive Information (${t.length} properties)`,o.style.borderBottom="2px solid #28a745",o.style.paddingBottom="5px",o.style.marginBottom="15px",n.appendChild(o),t.forEach(((e,t)=>{const o=document.createElement("div");o.style.marginBottom="15px",o.style.padding="12px",o.style.border="1px solid #dee2e6",o.style.borderRadius="5px",o.style.backgroundColor=t%2==0?"#f8f9fa":"#ffffff";const r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.marginBottom="8px";const s=document.createElement("strong");s.textContent=this.getReadablePropertyName(e.property.value),s.style.color="#495057",s.style.fontSize="14px",r.appendChild(s);const a=document.createElement("span");a.textContent=e.lang&&e.lang.value?`[${e.lang.value}]`:"[text]",a.style.fontSize="11px",a.style.color="#6c757d",a.style.backgroundColor="#e9ecef",a.style.padding="2px 6px",a.style.borderRadius="3px",r.appendChild(a),o.appendChild(r);const i=document.createElement("div");i.style.fontSize="11px",i.style.color="#6c757d",i.style.marginBottom="8px",i.style.wordBreak="break-all",i.innerHTML=`Property URI: <a href="${e.property.value}" target="_blank" style="color: #007cba;">${e.property.value}</a>`,o.appendChild(i);const l=document.createElement("div");l.style.color="#212529",l.style.fontSize="13px",l.style.lineHeight="1.5",l.style.padding="8px",l.style.backgroundColor="rgba(0, 123, 255, 0.1)",l.style.borderRadius="3px",l.style.wordBreak="break-word",l.textContent=e.value.value,o.appendChild(l),n.appendChild(o)})),e.appendChild(n)}addCompleteRelationshipsSection(e,t){const n=document.createElement("div");n.className="info-section",n.style.marginBottom="20px";const o=document.createElement("h3");o.textContent=`Relationships & Classifications (${t.length} relations)`,o.style.borderBottom="2px solid #ffc107",o.style.paddingBottom="5px",o.style.marginBottom="15px",n.appendChild(o);const r=document.createElement("div");r.style.backgroundColor="#fff3cd",r.style.border="1px solid #ffeaa7",r.style.borderRadius="4px",r.style.padding="8px",r.style.marginBottom="15px",r.style.fontSize="12px",r.innerHTML="\n      <strong>ℹ️ Note:</strong> These are <strong>semantic relationships</strong> from ontologies (what this term IS), \n      different from the <strong>graph connections</strong> (which entities are associated with this term in your data).\n    ",n.appendChild(r),t.forEach(((e,t)=>{const o=document.createElement("div");o.style.marginBottom="15px",o.style.padding="12px",o.style.border="1px solid #ffc107",o.style.borderRadius="5px",o.style.backgroundColor=t%2==0?"#fff8e1":"#ffffff";const r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.marginBottom="8px";const s=document.createElement("strong");s.textContent=this.getReadablePropertyName(e.property.value),s.style.color="#856404",s.style.fontSize="14px",r.appendChild(s);const a=document.createElement("span");a.textContent="[SEMANTIC]",a.style.fontSize="10px",a.style.color="#856404",a.style.backgroundColor="#ffc107",a.style.padding="2px 6px",a.style.borderRadius="3px",r.appendChild(a),o.appendChild(r);const i=document.createElement("div");i.style.fontSize="11px",i.style.color="#6c757d",i.style.marginBottom="8px",i.style.wordBreak="break-all",i.innerHTML=`Relation URI: <a href="${e.property.value}" target="_blank" style="color: #007cba;">${e.property.value}</a>`,o.appendChild(i);const l=document.createElement("div");if(l.style.padding="10px",l.style.backgroundColor="rgba(255, 193, 7, 0.1)",l.style.borderRadius="4px",l.style.border="1px solid rgba(255, 193, 7, 0.3)",e.valueLabel&&e.valueLabel.value){const t=document.createElement("div");t.style.fontWeight="bold",t.style.color="#212529",t.style.fontSize="14px",t.style.marginBottom="6px",t.textContent=`➤ ${e.valueLabel.value}`,l.appendChild(t);const n=this.getSimpleOntologySource(e.value.value);if(n){const e=document.createElement("div");e.style.fontSize="11px",e.style.color="#6c757d",e.style.marginBottom="6px",e.innerHTML=`📚 <strong>Source:</strong> ${n}`,l.appendChild(e)}}const d=document.createElement("div");d.style.fontSize="11px",d.style.color="#495057",d.style.wordBreak="break-all",d.innerHTML=`🔗 Target URI: <a href="${e.value.value}" target="_blank" style="color: #007cba;">${e.value.value}</a>`,l.appendChild(d),o.appendChild(l),n.appendChild(o)})),e.appendChild(n)}getSimpleOntologySource(e){if(!e||"string"!=typeof e)return"Unknown Source";const t={"http://www.w3.org/1999/02/22-rdf-syntax-ns#":"RDF","http://www.w3.org/2000/01/rdf-schema#":"RDFS","http://www.w3.org/2002/07/owl#":"OWL","http://www.w3.org/2004/02/skos/core#":"SKOS","http://purl.org/dc/elements/1.1/":"DC","http://purl.org/dc/terms/":"DCTERMS","http://xmlns.com/foaf/0.1/":"FOAF","http://purl.obolibrary.org/obo/GO_":"GO (OBO)","http://purl.obolibrary.org/obo/DOID_":"DOID (OBO)","http://purl.obolibrary.org/obo/CHEBI_":"ChEBI (OBO)","http://purl.obolibrary.org/obo/CL_":"CL (OBO)","http://purl.obolibrary.org/obo/PR_":"PRO (OBO)","http://purl.obolibrary.org/obo/UBERON_":"Uberon (OBO)","http://purl.obolibrary.org/obo/SO_":"SO (OBO)","http://purl.obolibrary.org/obo/NCBITaxon_":"NCBI Taxonomy (OBO)","http://purl.obolibrary.org/obo/RO_":"RO (OBO)","http://purl.obolibrary.org/obo/BFO_":"BFO (OBO)","http://purl.uniprot.org/core/":"UniProt Core","http://rdf.ebi.ac.uk/terms/ensembl/":"Ensembl (EBI)","http://www.ebi.ac.uk/ols/ontologies/":"OLS (EBI)"};for(const n in t)if(e.startsWith(n))return t[n];try{const t=new URL(e);if("purl.obolibrary.org"===t.hostname&&t.pathname.startsWith("/obo/")){const e=t.pathname.split("/");if(e.length>2&&"obo"===e[1]){const t=e[2].split("_")[0];if(t)return`${t.toUpperCase()} (OBO Library)`}return"OBO Library"}return t.hostname}catch(t){const n=e.lastIndexOf("#");if(n>0){const t=e.substring(0,n);if(t.length>5)return t}const o=e.lastIndexOf("/");if(o>0){const t=e.substring(0,o);if(t.length>5&&t.includes(":/"))return t}return"Unknown Source"}}addCompleteTechnicalSection(e,t){const n=document.createElement("div");n.className="info-section",n.style.marginBottom="20px";const o=document.createElement("div");o.style.cursor="pointer",o.style.borderBottom="2px solid #6c757d",o.style.paddingBottom="5px",o.style.marginBottom="15px";const r=document.createElement("h3");r.textContent=`▼ Technical Properties (${t.length} properties)`,r.style.margin="0",o.appendChild(r);const s=document.createElement("div");s.className="technical-content",s.style.display="none",t.forEach(((e,t)=>{const n=document.createElement("div");n.style.marginBottom="12px",n.style.padding="10px",n.style.border="1px solid #dee2e6",n.style.borderRadius="4px",n.style.backgroundColor=t%2==0?"#f8f9fa":"#ffffff";const o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="center",o.style.marginBottom="6px";const r=document.createElement("strong");r.textContent=e.property.value.split(/[/#]/).pop(),r.style.fontSize="12px",r.style.color="#495057",o.appendChild(r);const a=e.valueType?e.valueType.value:"unknown",i=document.createElement("span");i.textContent=a.toUpperCase(),i.style.fontSize="9px",i.style.color="uri"===a?"#007cba":"#28a745",i.style.backgroundColor="uri"===a?"#e3f2fd":"#e8f5e9",i.style.padding="2px 4px",i.style.borderRadius="2px",o.appendChild(i),n.appendChild(o);const l=document.createElement("div");l.style.fontSize="10px",l.style.color="#6c757d",l.style.marginBottom="6px",l.style.wordBreak="break-all",l.innerHTML=`<a href="${e.property.value}" target="_blank" style="color: #6c757d;">${e.property.value}</a>`,n.appendChild(l);const d=document.createElement("div");d.style.fontSize="11px",d.style.padding="6px",d.style.backgroundColor="#f8f9fa",d.style.borderRadius="3px",d.style.wordBreak="break-all","uri"===a?d.innerHTML=`<a href="${e.value.value}" target="_blank" style="color: #007cba;">${e.value.value}</a>`:d.textContent=e.value.value,n.appendChild(d),s.appendChild(n)})),o.addEventListener("click",(()=>{const e="none"!==s.style.display;s.style.display=e?"none":"block",r.textContent=`${e?"▶":"▼"} Technical Properties (${t.length} properties)`})),n.appendChild(o),n.appendChild(s),e.appendChild(n)}addDataSummary(e,t){const n=document.createElement("div");n.className="info-section",n.style.marginTop="20px",n.style.padding="10px",n.style.backgroundColor="#e9ecef",n.style.borderRadius="5px";const o=document.createElement("h4");o.textContent="Data Retrieval Summary",o.style.color="#495057",o.style.marginBottom="8px",n.appendChild(o);const r=document.createElement("div");r.style.fontSize="12px",r.style.color="#6c757d";const s=t.descriptive&&t.descriptive.results?t.descriptive.results.bindings.length:0,a=t.relationships&&t.relationships.results?t.relationships.results.bindings.length:0,i=t.technical&&t.technical.results?t.technical.results.bindings.length:0,l=s+a+i;r.innerHTML=`\n      • <strong>${s}</strong> descriptive properties retrieved<br>\n      • <strong>${a}</strong> relationships found<br>\n      • <strong>${i}</strong> technical properties collected<br>\n      • <strong>${l}</strong> total properties from API<br>\n      • Endpoint: <code>${this.currentEndpoint||"default"}</code>\n    `,n.appendChild(r),e.appendChild(n)}addDetailedInfoRow(e,t,n,o=!1){if(!n||"None"===n||""===n)return;const r=document.createElement("div");r.style.marginBottom="10px",r.style.display="flex",r.style.flexDirection="column";const s=document.createElement("strong");s.textContent=t,s.style.color="#2c3e50",s.style.fontSize="13px",s.style.marginBottom="3px",r.appendChild(s);const a=document.createElement("div");if(a.style.paddingLeft="12px",a.style.color="#34495e",a.style.fontSize="12px",a.style.lineHeight="1.4",a.style.wordBreak="break-all",o&&"string"==typeof n&&n.startsWith("http")){const e=document.createElement("a");e.href=n,e.target="_blank",e.textContent=n,e.style.color="#007cba",e.style.textDecoration="underline",a.appendChild(e)}else a.textContent=n;r.appendChild(a),e.appendChild(r)}extractAccessionFromURI(e){if(!e)return"N/A";const t=e.match(/([A-Z]+)_(\d+)/);return t?`${t[1]}:${t[2]}`:e.split(/[/#]/).pop()}getReadablePropertyName(e){const t=e.split(/[/#]/).pop();return{subClassOf:"Is a type of",type:"Type",broader:"Broader concept",narrower:"Narrower concept",related:"Related to",sameAs:"Same as",equivalentClass:"Equivalent to",BFO_0000050:"Part of",RO_0002211:"Regulates",RO_0002212:"Negatively regulates",RO_0002213:"Positively regulates",label:"Label",comment:"Comment",definition:"Definition",hasDefinition:"Definition",hasExactSynonym:"Exact Synonym",hasRelatedSynonym:"Related Synonym",hasBroadSynonym:"Broad Synonym",hasNarrowSynonym:"Narrow Synonym",prefLabel:"Preferred Label",altLabel:"Alternative Label",title:"Title",description:"Description",id:"ID"}[t]||t.replace(/_/g," ")}displayBasicNodeDetails(e,t=null){const n=this.shadowRoot.querySelector(".node-details-panel");n&&n.remove();const o=document.createElement("div");o.className="node-details-panel";const r=document.createElement("div");r.className="panel-header";const s=document.createElement("h2");s.textContent=e.label||e.id,s.style.margin="0",s.style.fontSize="18px",s.style.fontWeight="bold";const a=document.createElement("button");a.textContent="×",a.className="close-btn",a.addEventListener("click",(()=>o.remove())),r.appendChild(s),r.appendChild(a),o.appendChild(r);const i=document.createElement("div");i.className="panel-content";const l=document.createElement("div");l.innerHTML=`\n      <h4>Informations disponibles</h4>\n      <p><strong>ID:</strong> ${e.id}</p>\n      <p><strong>Label:</strong> ${e.label}</p>\n      ${e.uri?`<p><strong>URI:</strong> <a href="${e.uri}" target="_blank">${e.uri}</a></p>`:""}\n    `;const d=this.links.filter((t=>t.source.id===e.id||t.target.id===e.id)).length,p=document.createElement("p");p.innerHTML=`<strong>Connexions:</strong> ${d}`,l.appendChild(p),i.appendChild(l),o.appendChild(i),this.shadowRoot.querySelector(".graph-container").appendChild(o)}showNotification(e,t="info"){const n=this.shadowRoot.querySelector(".notification");n&&n.remove();const o=document.createElement("div");o.className=`notification ${t}`,o.textContent=e,this.shadowRoot.querySelector(".graph-container").appendChild(o),setTimeout((()=>{o.classList.add("fade-out"),setTimeout((()=>o.remove()),500)}),3e3)}showTooltip(e,t,n){this.hideTooltip(),this.tooltipTimeout&&clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout((()=>{const o=document.createElement("div");o.className="tooltip";const r=document.createElement("h3");if(r.textContent=e.label,o.appendChild(r),e.uri){const t=document.createElement("p");t.innerHTML=`<strong>URI:</strong> ${e.uri}`,o.appendChild(t)}const s=this.links.filter((t=>t.source.id===e.id||t.target.id===e.id)).length,a=document.createElement("p");a.innerHTML=`<strong>Connexions:</strong> ${s}`,o.appendChild(a),o.style.left=`${t+15}px`,o.style.top=n-15+"px",this.shadowRoot.querySelector(".graph-container").appendChild(o)}),200)}hideTooltip(){this.tooltipTimeout&&clearTimeout(this.tooltipTimeout);const e=this.shadowRoot.querySelector(".tooltip");e&&e.remove()}showContextMenu(e,t,n){const o=this.shadowRoot.querySelector(".context-menu");o&&o.remove();const r=document.createElement("div");r.className="context-menu",r.style.left=`${t}px`,r.style.top=`${n}px`;const s=document.createElement("button");s.textContent="Récupérer les détails",s.addEventListener("click",(()=>{this.executeNodeQuery(e),r.remove()})),r.appendChild(s),this.shadowRoot.querySelector(".graph-container").appendChild(r);const a=this.shadowRoot.querySelector(".graph-container"),i=r.getBoundingClientRect(),l=a.getBoundingClientRect();i.right>l.right&&(r.style.left=t-i.width+"px"),i.bottom>l.bottom&&(r.style.top=n-i.height+"px")}render(){this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n          font-family: Arial, sans-serif;\n        }\n        .graph-container {\n          width: ${this.width}px;\n          height: ${this.height}px;\n          background-color: #f9f9f9;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          overflow: hidden;\n          position: relative;\n        }\n        svg {\n          width: 100%;\n          height: 100%;\n        }\n        .links line {\n          stroke: #999;\n          stroke-opacity: 0.6;\n          transition: stroke 0.3s, stroke-width 0.3s;\n        }\n        .nodes circle {\n          stroke: #fff;\n          stroke-width: 1.5px;\n          transition: stroke 0.3s, stroke-width 0.3s;\n        }\n        .node-label {\n          font-size: 12px;\n          pointer-events: none;\n          fill: #333;\n          text-anchor: middle;\n          dominant-baseline: middle;\n        }\n        .node-highlighted circle {\n          stroke: #ff4444 !important;\n          stroke-width: 3px !important;\n        }\n        .link-highlighted {\n          stroke: #ff4444 !important;\n          stroke-width: 2px !important;\n          stroke-opacity: 1 !important;\n        }\n        .tooltip {\n          position: absolute;\n          background: white;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          padding: 10px;\n          pointer-events: none;\n          z-index: 10;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n          max-width: 300px;\n          font-size: 12px;\n        }\n        .tooltip h3 {\n          margin: 0 0 5px 0;\n          font-size: 14px;\n        }\n        .tooltip p {\n          margin: 3px 0;\n        }\n        .node-details-panel {\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          width: 350px;\n          max-height: calc(100% - 20px);\n          background: white;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          overflow: auto;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n          z-index: 5;\n          display: flex;\n          flex-direction: column;\n        }\n        .panel-header {\n          padding: 10px;\n          background: #f0f0f0;\n          border-bottom: 1px solid #ddd;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n        .panel-header h3 {\n          margin: 0;\n          font-size: 16px;\n        }\n        .close-btn {\n          border: none;\n          background: transparent;\n          font-size: 20px;\n          cursor: pointer;\n          padding: 0 5px;\n        }\n        .node-uri {\n          padding: 10px;\n          border-bottom: 1px solid #eee;\n          font-size: 12px;\n          word-break: break-all;\n        }\n        .panel-content {\n          padding: 10px;\n          overflow: auto;\n        }\n        .panel-content table {\n          width: 100%;\n          border-collapse: collapse;\n        }\n        .panel-content th,\n        .panel-content td {\n          text-align: left;\n          padding: 5px;\n          border-bottom: 1px solid #eee;\n          font-size: 12px;\n          word-break: break-all;\n        }\n        .context-menu {\n          position: absolute;\n          background: white;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n          padding: 5px 0;\n          z-index: 20;\n        }\n        .context-menu button {\n          display: block;\n          width: 100%;\n          border: none;\n          background: white;\n          padding: 8px 15px;\n          text-align: left;\n          cursor: pointer;\n        }\n        .context-menu button:hover {\n          background: #f0f0f0;\n        }\n        .notification {\n          position: absolute;\n          bottom: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          padding: 10px 20px;\n          border-radius: 4px;\n          z-index: 30;\n          transition: opacity 0.5s;\n        }\n        .notification.info {\n          background: #e3f2fd;\n          border: 1px solid #2196f3;\n        }\n        .notification.error {\n          background: #ffebee;\n          border: 1px solid #f44336;\n        }\n        .notification.fade-out {\n          opacity: 0;\n        }\n      </style>\n      <div class="graph-container">\n        <svg></svg>\n      </div>\n    `,this.createForceGraph(),this.initGlobalEventHandlers()}initGlobalEventHandlers(){const e=this.shadowRoot.querySelector(".graph-container");e.addEventListener("click",(e=>{const t=this.shadowRoot.querySelector(".context-menu");t&&t.remove()})),e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e.addEventListener("mouseleave",(()=>{this.hideTooltip()}))}createForceGraph(){const e=d3.select(this.shadowRoot.querySelector("svg")),t=this.width,n=this.height;if(e.selectAll("*").remove(),!this.nodes||0===this.nodes.length)return e.append("text").attr("x",t/2).attr("y",n/2-20).attr("text-anchor","middle").style("font-size","16px").text("Aucune donnée à visualiser"),void e.append("text").attr("x",t/2).attr("y",n/2+20).attr("text-anchor","middle").style("font-size","14px").text('Veuillez saisir un endpoint SPARQL et une requête, puis cliquez sur "Exécuter".');const o=new Map;this.nodes.forEach((e=>o.set(e.id,0))),this.links.forEach((e=>{o.set(e.source,(o.get(e.source)||0)+1),o.set(e.target,(o.get(e.target)||0)+1)}));const r=e=>{const t=o.get(e);return Math.max(8,Math.min(25,8+2*t))},s=d3.forceSimulation(this.nodes).force("link",d3.forceLink(this.links).id((e=>e.id))).force("charge",d3.forceManyBody().strength(-200)).force("center",d3.forceCenter(t/2,n/2)).force("collision",d3.forceCollide().radius((e=>r(e.id)+20))).force("x",d3.forceX(t/2).strength(.1)).force("y",d3.forceY(n/2).strength(.1)),a=e=>{const o=r(e.id);e.x=Math.max(o,Math.min(t-o,e.x)),e.y=Math.max(o,Math.min(n-o,e.y))},i=e.append("g").attr("class","links").selectAll("line").data(this.links).enter().append("line").attr("stroke","#999").attr("stroke-width",1),l=e.append("g").attr("class","nodes").selectAll("g").data(this.nodes).enter().append("g").call(d3.drag().on("start",(function(e,t){e.active||s.alphaTarget(.3).restart();t.fx=t.x,t.fy=t.y})).on("drag",(function(e,o){const s=r(o.id);o.fx=Math.max(s,Math.min(t-s,e.x)),o.fy=Math.max(s,Math.min(n-s,e.y))})).on("end",(function(e,t){e.active||s.alphaTarget(0);t.fx=null,t.fy=null}))).on("mouseover",((e,t)=>{const n=this.links.filter((e=>e.source.id===t.id||e.target.id===t.id)),o=new Set(n.flatMap((e=>[e.source.id,e.target.id])));i.classed("link-highlighted",(e=>e.source.id===t.id||e.target.id===t.id)),l.classed("node-highlighted",(e=>o.has(e.id))),this.showTooltip(t,e.offsetX,e.offsetY)})).on("mouseout",(()=>{i.classed("link-highlighted",!1),l.classed("node-highlighted",!1),this.hideTooltip()})).on("contextmenu",((e,t)=>{e.preventDefault(),this.showContextMenu(t,e.offsetX,e.offsetY)}));l.append("circle").attr("r",(e=>r(e.id))).attr("fill","#69b3a2"),l.append("text").attr("class","node-label").text((e=>e.label||e.id)),s.on("tick",(()=>{l.each(a),i.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),l.attr("transform",(e=>`translate(${e.x},${e.y})`))}))}}customElements.define("vis-graph",e);export{e as VisGraph};
//# sourceMappingURL=vis-graph.esm.js.map
