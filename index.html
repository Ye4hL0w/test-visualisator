<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisateur</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="sample-data.js"></script>
    <script src="visualisator.js"></script>
</head>
<body>
    <header>
        <h1>Visualisateur de Données Métabolomiques</h1>
        <nav>
            <button id="view-scatter">Graphique à dispersion</button>
            <button id="view-heatmap">Carte de chaleur</button>
            <button id="view-network">Réseau d'interactions</button>
            <button id="view-barplot">Diagramme à barres</button>
        </nav>
    </header>

    <main>
        <section id="data-info">
            <h2>Informations sur les données</h2>
            <div id="data-summary"></div>
        </section>

        <section id="visualization-container">
            <div id="loading">Chargement des données...</div>
            <div id="visualization"></div>
        </section>

        <section id="controls">
            <h2>Paramètres de visualisation</h2>
            <div id="help-message" class="info">
                Sélectionnez les dimensions à visualiser puis cliquez sur un type de graphique ci-dessus.
            </div>
            <div class="control-group">
                <label for="x-axis-select">Axe X:</label>
                <select id="x-axis-select"></select>
            </div>
            <div class="control-group">
                <label for="y-axis-select">Axe Y:</label>
                <select id="y-axis-select"></select>
            </div>
            <div class="control-group">
                <label for="color-by-select">Colorer par:</label>
                <select id="color-by-select"></select>
            </div>
            <div class="control-group">
                <label for="filter-select">Filtrer:</label>
                <select id="filter-select"></select>
                <input type="text" id="filter-value" placeholder="Valeur">
                <button id="apply-filter">Appliquer</button>
            </div>
        </section>
        
        <section id="data-management">
            <h2>Gestion des données</h2>
            <div class="button-container">
                <button id="load-sample-data">Charger données d'exemple</button>
                <button id="clear-data">Effacer données</button>
            </div>
            <div id="data-status" class="info"></div>
        </section>
    </main>

    <footer>
        <p>Visualisateur intégré pour le chatbot gen²kgbot</p>
    </footer>
    
    <script>
        // Fonction pour vérifier si les données sont chargées
        function checkDataStatus() {
            const dataStatus = document.getElementById('data-status');
            if (hasStoredData()) {
                dataStatus.innerHTML = '<p>✅ Données chargées avec succès</p>';
                dataStatus.className = 'success';
                
                // Masquer le message d'aide après un certain temps
                setTimeout(() => {
                    const helpMessage = document.getElementById('help-message');
                    if (helpMessage) {
                        helpMessage.style.display = 'none';
                    }
                }, 5000);
            } else {
                dataStatus.innerHTML = '<p>❌ Aucune donnée chargée</p><p>Cliquez sur "Charger données d\'exemple" pour commencer</p>';
                dataStatus.className = 'error';
            }
        }
        
        // Gestionnaires pour les boutons de gestion des données
        document.getElementById('load-sample-data').addEventListener('click', function() {
            this.disabled = true;
            this.textContent = 'Chargement en cours...';
            
            // Charger les données d'exemple
            const data = loadSampleData();
            
            // Mettre à jour l'interface sans recharger la page
            setTimeout(() => {
                checkDataStatus();
                initializeVisualizationIfNeeded();
                this.disabled = false;
                this.textContent = 'Charger données d\'exemple';
            }, 500);
        });
        
        document.getElementById('clear-data').addEventListener('click', function() {
            // Supprimer les données
            clearStoredData();
            
            // Mettre à jour l'interface
            checkDataStatus();
            
            // Recharger la page pour vider la visualisation
            location.reload();
        });
        
        // Vérifier immédiatement l'état des données
        document.addEventListener('DOMContentLoaded', function() {
            checkDataStatus();
        });
    </script>
</body>
</html> 